# ü§ñ API Integration & Prompt Engineering

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Google Gemini 1.5/2.0 Flash** (–≤ –∫–æ–¥–µ —É–∫–∞–∑–∞–Ω –∞–ª–∏–∞—Å `gemini-3-flash-preview` —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ—Å–ª–µ–¥–Ω–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º SDK) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SDK

*   **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `@google/genai`
*   **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
    ```typescript
    const ai = new GoogleGenAI({ apiKey: process.env.NEXT_PUBLIC_API_KEY });
    ```

## 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è (`generateAd`)

### –ü—Ä–æ–º–ø—Ç (Prompt Engineering)
–ü—Ä–æ–º–ø—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `buildPrompt` –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π:

1.  **System Instruction**:
    *   –†–æ–ª—å: "Top-tier professional copywriter".
    *   –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π.
    *   –§–æ—Ä–º–∞—Ç: Markdown.
    *   –°—Ç—Ä—É–∫—Ç—É—Ä–∞: Hook -> Body -> Details -> CTA.
    *   –ó–∞–¥–∞—á–∞ Smart Tip: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞.

2.  **User Context (Data)**:
    *   –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ JSON-–æ–±—ä–µ–∫—Ç–∞ —Ñ–æ—Ä–º—ã –≤ —á–∏—Ç–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ (`getDetailsString`).
    *   –ü—Ä–∏–º–µ—Ä: "Category: Auto, Model: BMW X5, Mileage: 150000...".

3.  **Tone Instruction**:
    *   –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å—Ç–∏–ª—è. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è 'aggressive': *"Use phrases like '–£—Å–ø–µ–π –∫—É–ø–∏—Ç—å', '–¢–æ—Ä–≥–∞ –Ω–µ—Ç'"*.

### JSON Schema (Structured Output)
–ú—ã —Ñ–æ—Ä—Å–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

```typescript
responseSchema: {
  type: Type.OBJECT,
  properties: {
    adText: { type: Type.STRING },   // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    smartTip: { type: Type.STRING }, // –°–æ–≤–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü—É
  },
  required: ["adText", "smartTip"],
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ:
1.  –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è MIME-—Ç–∏–ø –∏ Base64 –¥–∞–Ω–Ω—ã–µ.
2.  –ö —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –ø—Ä–æ–º–ø—Ç—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: *"[System Note: An image is provided. Analyze it to add specific visual details...]"*.

## 2. SEO –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (`optimizeAdWithKeywords`)

–≠—Ç–æ –≤—Ç–æ—Ä–∏—á–Ω—ã–π –≤—ã–∑–æ–≤ API, –∫–æ—Ç–æ—Ä—ã–π –±–µ—Ä–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–≥–æ –≤—ã–∑–æ–≤–∞.

*   **–†–æ–ª—å**: "Expert SEO-marketer for Avito/Youla".
*   **–ó–∞–¥–∞—á–∞**:
    1.  –ù–∞–π—Ç–∏ 5-8 –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π (LSI).
    2.  –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ç–µ–∫—Å—Ç, –≤–Ω–µ–¥—Ä–∏–≤ —ç—Ç–∏ –∫–ª—é—á–∏ –Ω–∞—Ç–∏–≤–Ω–æ.
    3.  –í–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π –æ—Ç–¥–µ–ª—å–Ω–æ.
*   **Output**: JSON —Å –ø–æ–ª—è–º–∏ `rewrittenAd` (string) –∏ `keywords` (array of strings).

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–µ–π—Å—ã:
*   **429 Too Many Requests**: –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –æ—à–∏–±–∫–∞ "–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤".
*   **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏**: –û–±—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
*   **Safety Filters**: –ï—Å–ª–∏ Gemini –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç (Hate speech, harassment), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –æ—à–∏–±–∫–∞.